---
title: "Phenology_Models"
output: 
  html_document: 
    keep_md: true
date: "2025-01-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
library(lubridate)
library(lme4)
library(bbmle)
library(googlesheets4)
library(lmtest)
library(car)
library(lmerTest)

sem <- function(x, na.rm=FALSE) {           #for caclulating standard error
  sd(x,na.rm=na.rm)/sqrt(length(na.omit(x)))
} 
```

```{r}
#Input Cleaned Common Garden Data
UCD22_23 <- read_csv("../input/UCD22_23_transplant.csv")
WL2_23 <- read_csv("../input/WL2_23.csv")
WL2_24 <- read_csv("../input/WL2_24.csv")

#Input Climate Distance Data
clim_dist_UCD22_23 <- read_csv("../input/growthseason_GowersEnvtalDist_UCD.csv")
wtr_year_UCD <- read_csv("../input/full_year_GowersEnvtalDist_UCD_wtr_year.csv")
clim_dist_WL2_23 <- read_csv("../input/growthseason_GowersEnvtalDist_WL2.csv")
wtr_year_WL2_23 <- read_csv("../input/full_year_GowersEnvtalDist_WL2_wtr_year.csv")
both_clim_dist_WL2_24 <- read_csv("../input/Gowers_WL2_2024.csv")

#Input Fitness Data
UCD_fruit <- read_csv("../input/UCD_Fruits.csv")
WL2_24_fruit <- read_csv("../input/WL2_Fruits_Y2.csv")
WL2_23_fruit <- read_csv("../input/WL2_Fruits_Y1.csv")
WL2_24_frt_prob <- read_csv("../input/WL2_ProbFruits_Y2.csv")
UCD_frt_prob <- read_csv("../input/ProbFruits_UCD.csv")
WL2_prob_fit <- read_csv("../input/WL2_ProbFitness.csv")
WL2_total_fit <- read_csv("../input/WL2_TotalRepOutput.csv")
```

## Setting up data frame

### Select only the columns of interest and only parent pops from the WL2_24 garden

```{r}
UCD22_23 <- UCD22_23 %>%
  mutate(bed = str_extract(block, "^[A-Za-z]")) %>% #create column for bed by extracting info from block column
  select(block, bed, row, col, everything()) %>% #reorder columns
  select(block, bed, row, col, pop, mf, rep, bud.date_dt, flower.date_dt, fruit.date_dt, last.FL.date_dt, last.FR.date_dt, death.date_dt) %>% #select columns of interest
  filter(pop != "buffer") #filter out buffer plants

WL2_23 <- WL2_23 %>%
  select(block, bed, row, col, pop, mf, rep, bud.date_dt, flower.date_dt, fruit.date_dt, last.FL.date_dt, last.FR.date_dt, death.date_dt) %>%
  filter(grepl("^\\d+$", rep)) #removes buffer plants and empty spaces

WL2_24 <- WL2_24 %>%
  select(bed, row, col, pop, mf, rep, bud.date_dt, flower.date_dt, fruit.date_dt, last.FL.date_dt, last.FR.date_dt, death.date_dt) %>%
  left_join(WL2_23 %>% select(block, bed, row, col), by=c("bed", "row", "col")) %>% #add block info using WL2_23 block column
  select(block, bed, row, col, everything()) #reorder columns 
```

### Combine all gardens into one tibble, add site and year columns

```{r}
parent_pheno <- bind_rows(
  UCD22_23 %>% mutate(site="UCD_23"),
  WL2_23 %>% mutate(site="WL2_23"),
  WL2_24 %>% mutate(site="WL2_24")
)

parent_pheno <- parent_pheno %>%
  separate(site, into = c("site", "year"), sep = "_")
```

### Add elevation and latitude data
No longer need this chunk with climate distance input below 
```{r, eval=FALSE}
both_clim_dist_WL2_24 <- both_clim_dist_WL2_24 %>%
  filter(TimePd == "Recent") %>%
  rename(pop=parent.pop)

parent_pheno <- parent_pheno %>%
  left_join(both_clim_dist_WL2_24 %>% select(pop, elev_m, Lat), by="pop")
```

### Add recent climate distance - could have also added climate distance from fitness data csv

```{r}
clim_dist_UCD22_23 <- clim_dist_UCD22_23 %>%
  filter(TimePd == "Recent") %>%
  rename(pop=parent.pop) %>%
  rename(GrwSsn_GD=Gowers_Dist) %>%
  mutate(site="UCD")

wtr_year_UCD <- wtr_year_UCD %>%
  filter(TimePd == "Recent") %>%
  rename(pop=parent.pop) %>%
  rename(Wtr_Year_GD=Gowers_Dist) %>%
  mutate(site="UCD")

clim_dist_WL2_23 <- clim_dist_WL2_23 %>%
  filter(TimePd == "Recent") %>%
  rename(pop=parent.pop) %>% 
  rename(GrwSsn_GD=Gowers_Dist) %>%
  mutate(site = "WL2") %>%
  mutate(year= 23)

wtr_year_WL2_23 <- wtr_year_WL2_23 %>%
  filter(TimePd == "Recent") %>%
  rename(pop=parent.pop) %>%
  rename(Wtr_Year_GD=Gowers_Dist) %>%
  mutate(site = "WL2") %>%
  mutate(year=23)

both_clim_dist_WL2_24 <- both_clim_dist_WL2_24 %>%
  filter(TimePd == "Recent") %>%
  mutate(site = "WL2") %>%
  rename(pop=parent.pop) %>%
  mutate(year = 24)

parent_pheno_climdist <- parent_pheno %>%
  mutate(year = as.numeric(year)) %>%
  left_join(clim_dist_UCD22_23 %>% select(pop,elev_m, GrwSsn_GD, site), by = c("pop", "site")) %>%
  left_join(wtr_year_UCD %>% select(pop, Wtr_Year_GD, site), by = c("pop", "site")) %>%
  left_join(clim_dist_WL2_23 %>% select(pop, GrwSsn_GD, site, year), by = c("pop", "site", "year")) %>%
  left_join(wtr_year_WL2_23 %>% select(pop, Wtr_Year_GD, site, year), by = c("pop", "site", "year")) %>%
  left_join(both_clim_dist_WL2_24 %>% select(pop, site, year, GrwSsn_GD, Wtr_Year_GD), by = c("pop", "site", "year")) %>%
  mutate(
    Grw_Ssn_GD = coalesce(GrwSsn_GD.x, GrwSsn_GD.y, GrwSsn_GD),
    Wtr_Yr_GD = coalesce(Wtr_Year_GD.x, Wtr_Year_GD.y, Wtr_Year_GD)
  ) %>%
  select(-GrwSsn_GD.x, -GrwSsn_GD.y, -GrwSsn_GD, -Wtr_Year_GD.x, -Wtr_Year_GD.y, -Wtr_Year_GD)

```

### Add fitness data

```{r}
#number of fruits made by each indiv at UCD
UCD_fruit <- UCD_fruit %>%
  mutate(site="UCD")

#prob making a fruit in year 1 at UCD given survival to bolting
UCD_frt_prob <- UCD_frt_prob %>%
  mutate(site = "UCD") %>%
  rename(UCD_Y1_Prob_Fruits=ProbFruits)

#number of fruits made at WL2 in 2023
WL2_23_fruit <- WL2_23_fruit %>%
  mutate(site="WL2") %>%
  mutate(year=23) %>%
  rename(row='bed-row') %>%
  rename(col='bed-col')

#number of fruits made at WL2 in 2024
WL2_24_fruit <- WL2_24_fruit %>%
  mutate(site="WL2") %>%
  mutate(year=24) 

#prob making a fruit in year 2 at WL2 (given the indiv survived to bolting)
WL2_24_frt_prob <- WL2_24_frt_prob %>%
  mutate(site="WL2") %>%
  mutate(year=24) %>%
  rename(WL2_Y2_Prob_Fruits=ProbFruits)

#prob of successfully reproducing - prob of making at least 1 fruit in year 1 or 2 at WL2
WL2_prob_fit <- WL2_prob_fit %>%
  rename(row=bed.row) %>%
  rename(col=bed.col) %>%
  rename(WL2_ProbFitness=ProbFitness) %>%
  mutate(site="WL2")
  
#Total repro output - total fruit number across both years at WL2
WL2_total_fit <- WL2_total_fit %>%
  rename(row=bed.row) %>%
  rename(col=bed.col) %>%
  rename(WL2_Total_Fitness=Total_Fitness) %>%
  rename(log_WL2_Total_Fitness=logTotalFitness) %>%
  mutate(site="WL2")

parent_pheno_fitness <- parent_pheno_climdist %>%
  left_join(UCD_fruit %>% select(block, row, col, site, fruits, FrFlN), by=c("block", "row", "col", "site")) %>%
  left_join(UCD_frt_prob %>% select(block, row, col, site, UCD_Y1_Prob_Fruits), by=c("block", "row", "col", "site")) %>%
  left_join(WL2_23_fruit %>% select(bed, row, col, site, year, fruits, FrFlN), by=c("bed", "row", "col", "year", "site")) %>%
  left_join(WL2_24_fruit %>% select(bed, row, col, site, year, fruits, FrFlN), by=c("bed", "row", "col", "year", "site")) %>%
  left_join(WL2_24_frt_prob %>% select(bed, row, col, site, year, WL2_Y2_Prob_Fruits), by=c("bed", "row", "col", "year", "site")) %>%
  left_join(WL2_prob_fit %>% select(bed, row, col, site, WL2_ProbFitness), by=c("bed", "row", "col", "site")) %>%
  left_join(WL2_total_fit %>% select(bed, row, col, site, WL2_Total_Fitness, log_WL2_Total_Fitness), by=c("bed", "row", "col", "site")) %>%
  mutate(
    Fruits = coalesce(fruits.x, fruits.y, fruits),
    FrFlw = coalesce(FrFlN.x, FrFlN.y, FrFlN)
  ) %>%
  select(-fruits.x, -fruits.y, -fruits, -FrFlN.x, -FrFlN.y, -FrFlN)
  #at UCD some rows have a 0 for ProbFruits but nothing for fruit and/or frflw and also the opposite - do I need to make sure if there is a 0 in ProbFruits that there is also a 0 in fruits
  #there are some cases where the plant has 0 fruits but the probability of making fruits is NA and not 0 because the plant might have still been alive by the last survey but not yet produced any fruits - what do I do here?
#this is because ProbFruits was the probabiliyt of making a fruit given survival to bolting so individuals that were still alive but didn't initiate reproduction by the last survey had a fruit count of 0 but were not included in the ProbFruits calc.
```

### Calculate duration of each reproductive stage and add binary column for initiating reproduction

```{r}
#Bud duration (flower.date - bud.date)
#Flower duration (last.FL.date - flower.date)
#Fruit duration (last.FR.date - fruit.date)
#Total repro duration (last.FR.date - bud.date)
#Initiate repro(1 if there is any repro date, 0 if no repro date)
  # I would want to use bud.date to determine if a plant initiated repro, but we missed the bud date for some plants

parent_pheno_duration <- parent_pheno_fitness %>%
  mutate(bud.duration = as.numeric(flower.date_dt - bud.date_dt)) %>%
  mutate(flower.duration = as.numeric(last.FL.date_dt - flower.date_dt)) %>%
  mutate(fruit.duration = as.numeric(last.FR.date_dt - fruit.date_dt)) %>%
  mutate(total.repro.duration = as.numeric(last.FR.date_dt - bud.date_dt)) %>%
  mutate(initiate.repro = if_else(
      !is.na(bud.date_dt) | !is.na(flower.date_dt) | 
      !is.na(fruit.date_dt) | !is.na(last.FR.date_dt) | 
      !is.na(last.FL.date_dt), 
      1, 0
    ))

#write.csv(parent_pheno_duration, "../input/parent_pheno.csv")
```

## Visualizing each repro duration across sites

```{r}
parent_pheno_duration %>%
  filter(!is.na(bud.duration)) %>%
  filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=bud.duration, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)

parent_pheno_duration %>%
  filter(!is.na(flower.duration)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=flower.duration, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)

parent_pheno_duration %>%
  filter(!is.na(fruit.duration)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=fruit.duration, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)

parent_pheno_duration %>%
  filter(!is.na(total.repro.duration)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=total.repro.duration, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)
```

## Visualize days to each repro stage

```{r}
parent_pheno_duration %>%
  filter(!is.na(bud.date_dt)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR", "YO7", "IH"))) %>%
  ggplot(aes(x=bud.date_dt, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop) #ALL YO7 budded on the same date  at WL2, All WL2 budded on the same date at WL2 (only 1 WL2 reproduced at UCD), TM2 flowering at UCD is very syncronous

parent_pheno_duration %>%
  filter(!is.na(flower.date_dt)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=flower.date_dt, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)

parent_pheno_duration %>%
  filter(!is.na(fruit.date_dt)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=fruit.date_dt, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)

parent_pheno_duration %>%
  filter(!is.na(last.FL.date_dt)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=last.FL.date_dt, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)

parent_pheno_duration %>%
  filter(!is.na(last.FR.date_dt)) %>%
  #filter(!(pop %in% c("CP2", "SQ1", "SQ3", "WR"))) %>%
  ggplot(aes(x=last.FR.date_dt, fill=site)) +
  geom_boxplot() +
  facet_wrap(~pop)
```

## Model: Does initiating reproduction differ by site/elevation?

```{r}
#THERE IS A CONVERGENCE ISSUE WITH A SITE*ELEV interaction, so split up the two

#Does initiating reproduction differ by site with pop as a random effect
initiate_site <- glmer(initiate.repro ~ site + (1|pop),
                  data=parent_pheno_duration,
                  family = binomial())

summary(initiate_site)
Anova(initiate_site)

#Does initiating reproduction differ by elevation?
initiate_elev_pop <- glmer(initiate.repro ~ elev_m + (1|pop),
                       data=parent_pheno_duration,
                       family=binomial()) #THERE IS A CONVERGENCE ERROR WITH POP AS A RANDOM EFFECT
summary(initiate_elev_pop)


initiate_elev <- glm(initiate.repro ~ elev_m, 
                     data= parent_pheno_duration,
                     family=binomial()) #GLM WITH ONLY ELEV AS PREDICTOR
initiate_elev_null <- glm(initiate.repro ~ 1,
                          data=parent_pheno_duration,
                          family=binomial())
#lrtest(initiate_elev_null, initiate_elev) 
#Error in lrtest.default(initiate_elev_null, initiate_elev) : 
  #models were not all fitted to the same size of dataset
#summary(initiate_elev)
```

### Filter to only include individuals that initiated reproduction
```{r}
init.repro <- parent_pheno_duration %>%
  filter(initiate.repro == 1)

#write.csv(init.repro, "../input/init.repro.csv")
```

```{r, eval=FALSE}
#ggplot(init.repro, aes(x=site, y=total.repro.duration, color=elev_m)) +
 # geom_point() +
 # geom_smooth(method="lm", aes(group=elev_m))

#ggplot(init.repro, aes(x=site, y=bud.duration, color=elev_m)) +
 # geom_point() +
  #geom_smooth(method="lm", aes(group=elev_m))

#ggplot(init.repro, aes(x=site, y=flower.duration, color=elev_m)) +
 # geom_point() +
  #geom_smooth(method="lm", aes(group=elev_m))

#ggplot(init.repro, aes(x=site, y=fruit.duration, color=elev_m)) +
 # geom_point() +
  #geom_smooth(method="lm", aes(group=elev_m))

```

## Probability of making at least one fruit ~ Phenology 

### Bud duration and survival to make at least one fruit at WL2

```{r}
init.repro %>% filter(site == "WL2")  %>% filter(year == 24) %>% filter(!(is.na(bud.duration))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
WL2_bud_dur_frt_prob <- init.repro %>%
  filter(site == "WL2") %>%
  filter(year == 24) %>%
  filter(!(is.na(bud.duration))) %>%
  filter(pop %in% c("BH", "CC", "IH", "SC", "TM2", "WL2", "YO7")) #%>%
  #left_join(WL2_24_frt_prob %>% select(bed, row, col, ProbFruits), by=c("bed", "row", "col")) #already in init.repro
  
ggplot(WL2_bud_dur_frt_prob, aes(x=bud.duration, y=WL2_Y2_Prob_Fruits, color=pop)) +
  geom_jitter(height=0.01)

WL2_24_bud_dur_prob_fruit <- glmer(WL2_Y2_Prob_Fruits ~ bud.duration + (1|pop),
                                   data=WL2_bud_dur_frt_prob,
                                   family=binomial)
#boundary (singular) fit: see help('isSingular') # pop explains little variation 
summary(WL2_24_bud_dur_prob_fruit) 
Anova(WL2_24_bud_dur_prob_fruit)

WL2_24_bud_dur_prob_fruit2 <- glmer(WL2_Y2_Prob_Fruits ~ bud.duration + (1|pop) + (1|block),
                                   data=WL2_bud_dur_frt_prob,
                                   family=binomial)
summary(WL2_24_bud_dur_prob_fruit2) #sig negative relationship with bud duration (shorter bud duration = better)
Anova(WL2_24_bud_dur_prob_fruit2)

#could calculate mean prob of making fruit and mean bud duration for each pop - but lose indiv variation
WL2_bud_dur_mean_frt_prob <- WL2_bud_dur_frt_prob %>%
  group_by(pop) %>%
  summarize(mean_frt_prob = mean(WL2_Y2_Prob_Fruits, na.rm=TRUE),
            sem_frt_prob = sem(WL2_Y2_Prob_Fruits, na.rm=TRUE),
            mean_bud_dur = mean(bud.duration, na.rm=TRUE),
            sem_bud_dur= sem(bud.duration, na.rm=TRUE)) %>%
  ungroup()

ggplot(WL2_bud_dur_mean_frt_prob, aes(x=mean_bud_dur, y=mean_frt_prob, color=pop))+
  geom_point() +
  geom_errorbar(aes(ymin=mean_frt_prob-sem_frt_prob,ymax=mean_frt_prob+sem_frt_prob),width=.2)

mean_frt_prob_reg <- glm(mean_frt_prob ~ mean_bud_dur,
                         family=gaussian(),
                         data= WL2_bud_dur_mean_frt_prob)
summary(mean_frt_prob_reg)
Anova(mean_frt_prob_reg)
```

### Bud timing and survival to make at least one fruit at WL2
```{r}
init.repro %>% filter(site == "WL2")  %>% filter(year == 24) %>% filter(!(is.na(bud.date_dt))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
WL2_bud_dt_frt_prob <- init.repro %>%
  filter(site == "WL2") %>%
  filter(year == 24) %>%
  filter(!(is.na(bud.date_dt))) %>%
  filter(!(pop %in% c("SQ1", "WR"))) #%>%
  #left_join(WL2_24_frt_prob %>% select(bed, row, col, ProbFruits), by=c("bed", "row", "col")) #already in init.repro
  
ggplot(WL2_bud_dt_frt_prob, aes(x=bud.date_dt, y=WL2_Y2_Prob_Fruits, color=pop)) +
  geom_jitter(height=0.01)
  
WL2_24_bud_dt_prob_fruit <- glmer(WL2_Y2_Prob_Fruits ~ bud.date_dt + (1|pop),
                                   data=WL2_bud_dt_frt_prob,
                                   family=binomial)
#boundary (singular) fit: see help('isSingular') #b/c pop explains 0 var 
summary(WL2_24_bud_dt_prob_fruit) 
Anova(WL2_24_bud_dt_prob_fruit)

WL2_24_bud_dt_prob_fruit2 <- glmer(WL2_Y2_Prob_Fruits ~ bud.date_dt + (1|pop) + (1|block),
                                   data=WL2_bud_dt_frt_prob,
                                   family=binomial)
#boundary (singular) fit: see help('isSingular') #b/c pop explains 0 var
summary(WL2_24_bud_dt_prob_fruit2) #sig neg relat (shorter days to budding is better)
Anova(WL2_24_bud_dt_prob_fruit2)
```

### Both WL2 years and probability of successfully reproducing

```{r}
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.duration))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
all_WL2_fit_prob_bud_dur <- init.repro %>%
  filter(site == "WL2")  %>%
  filter(!(is.na(bud.duration))) %>%
  #left_join(WL2_prob_fit %>% select(bed, row, col, ProbFitness), by=c("bed", "row", "col")) %>% #already in init_repro
  filter(!(pop %in% c("SQ1", "WR")))

ggplot(all_WL2_fit_prob_bud_dur, aes(x=bud.duration, y=WL2_ProbFitness, color=pop)) +
  geom_jitter(height=0.01)

prob_fit_bud_dur <- glmer(WL2_ProbFitness ~ bud.duration + (1|pop),
                                   data=all_WL2_fit_prob_bud_dur,
                                   family=binomial)
#boundary (singular) fit: see help('isSingular') #pop explains 0 var 
summary(prob_fit_bud_dur) #sig neg relat 
Anova(prob_fit_bud_dur)
plogis(fixef(prob_fit_bud_dur)) #Back transforming/Inverse Logit of the fixed effect coefficients

prob_fit_bud_dur2 <- glmer(WL2_ProbFitness ~ bud.duration + (1|pop) + (1|block),
                                   data=all_WL2_fit_prob_bud_dur,
                                   family=binomial)
summary(prob_fit_bud_dur2) #relat no longer sig with block in model 
Anova(prob_fit_bud_dur2)

ggplot(all_WL2_fit_prob_bud_dur, aes(x=bud.duration, y=WL2_ProbFitness, color=pop)) +
  geom_jitter(height=0.01) +
  facet_wrap(~block) #some blocks only have 1 or 2 individuals 
all_WL2_fit_prob_bud_dur %>% group_by(block) %>% summarise(n=n()) %>% arrange(n) #take blocks D and L out since less than 3 individuals

all_WL2_fit_prob_bud_dur_blocks <- all_WL2_fit_prob_bud_dur %>% 
  filter(block!="D", block!="L")

prob_fit_bud_dur3 <- glmer(WL2_ProbFitness ~ bud.duration + (1|pop) + (1|block),
                                   data=all_WL2_fit_prob_bud_dur_blocks,
                                   family=binomial)
summary(prob_fit_bud_dur3) #relat still not sig 
Anova(prob_fit_bud_dur3)
```

```{r}
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.date_dt))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
all_WL2_fit_prob_dt_bud <- init.repro %>%
  filter(site == "WL2")  %>%
  filter(!(is.na(bud.date_dt))) %>%
  #left_join(WL2_prob_fit %>% select(bed, row, col, ProbFitness), by=c("bed", "row", "col")) #%>% #already in init_repro
  filter(!(pop %in% c("SQ1", "WR", "FR"))) #less than 3 individuals 

ggplot(all_WL2_fit_prob_dt_bud, aes(x=bud.date_dt, y=WL2_ProbFitness, color=pop)) +
  geom_jitter(height=0.01)

prob_fit_dt_bud <- glmer(WL2_ProbFitness ~ bud.date_dt + (1|pop),
                                   data=all_WL2_fit_prob_dt_bud,
                                   family=binomial)
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(prob_fit_dt_bud) #sig neg relat (shorter days to budding better)
Anova(prob_fit_dt_bud)

prob_fit_dt_bud2 <- glmer(WL2_ProbFitness ~ bud.date_dt + (1|pop) + (1|block),
                                   data=all_WL2_fit_prob_dt_bud,
                                   family=binomial)
summary(prob_fit_dt_bud2) #relat still sig after adding block 
Anova(prob_fit_dt_bud2)
```

### Bud duration and survival to make at least one fruit at UCD

```{r}
init.repro %>% filter(site == "UCD")  %>% filter(!(is.na(bud.duration))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
UCD_bud_dur_frt_prob <- init.repro %>%
  filter(site == "UCD") %>%
  filter(!(is.na(bud.duration))) %>%
  filter(pop %in% c("BH", "TM2"))# %>% #only 2 pops with high enough sample size 
 # left_join(UCD_frt_prob %>% select(block, row, col, ProbFruits), by=c("block", "row", "col")) #already in init_repro
  
ggplot(UCD_bud_dur_frt_prob, aes(x=bud.duration, y=UCD_Y1_Prob_Fruits, color=pop)) +
  geom_jitter(height=0.01)

UCD_bud_dur_prob_fruit <- glmer(UCD_Y1_Prob_Fruits ~ bud.duration + (1|pop),
                                   data=UCD_bud_dur_frt_prob,
                                   family=binomial)
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dur_prob_fruit) #not sig 
Anova(UCD_bud_dur_prob_fruit)

UCD_bud_dur_prob_fruit2 <- glmer(UCD_Y1_Prob_Fruits ~ bud.duration + (1|pop) + (1|block),
                                   data=UCD_bud_dur_frt_prob,
                                   family=binomial)
#Warning: unable to evaluate scaled gradientWarning: Model failed to converge: degenerate  Hessian with 1 negative eigenvalues 
summary(UCD_bud_dur_prob_fruit2) #not sig 
```

### Bud timing and survival to make at least one fruit at UCD
```{r}
init.repro %>% filter(site == "UCD")  %>% filter(!(is.na(bud.date_dt))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
UCD_bud_dt_frt_prob <- init.repro %>%
  filter(site == "UCD") %>%
  filter(!(is.na(bud.date_dt))) %>%
  filter(!(pop %in% c("CP2", "FR", "SQ3", "WL2", "CC"))) #%>% #less than 3 indivs
  #left_join(UCD_frt_prob %>% select(block, row, col, ProbFruits), by=c("block", "row", "col")) #already in init_repro
  
ggplot(UCD_bud_dt_frt_prob, aes(x=bud.date_dt, y=UCD_Y1_Prob_Fruits, color=pop)) +
  geom_jitter(height=0.01)
  
UCD_bud_dt_prob_fruit <- glmer(UCD_Y1_Prob_Fruits ~ bud.duration + (1|pop),
                                   data=UCD_bud_dt_frt_prob,
                                   family=binomial)
summary(UCD_bud_dt_prob_fruit) #not sig 
Anova(UCD_bud_dt_prob_fruit)

UCD_bud_dt_prob_fruit2 <- glmer(UCD_Y1_Prob_Fruits ~ bud.duration + (1|pop) + (1|block),
                                   data=UCD_bud_dt_frt_prob,
                                   family=binomial)
summary(UCD_bud_dt_prob_fruit2) #not sig 
```

## WL2 total fitness

```{r}
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.duration))) %>% filter(!(is.na(WL2_Total_Fitness))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
WL2_total_fit_bud_dur <- init.repro %>%
  filter(site == "WL2") %>%
  filter(!(is.na(bud.duration))) %>% 
  #left_join(WL2_total_fit %>% select(bed, row, col, Total_Fitness, logTotalFitness), by=c("bed", "row", "col")) %>% #already in init_repro
  filter(!(is.na(WL2_Total_Fitness))) %>%
  filter(!(pop %in% c("SQ1", "WR")))

ggplot(WL2_total_fit_bud_dur, aes(x=bud.duration, y=WL2_Total_Fitness, color=pop)) +
  geom_point()

ggplot(WL2_total_fit_bud_dur, aes(x=WL2_Total_Fitness)) + #pretty skewed
  geom_histogram()
ggplot(WL2_total_fit_bud_dur, aes(x=log_WL2_Total_Fitness)) + #log transformation is better 
  geom_histogram()

WL2_bud_dur_total_fit <- lmer(log_WL2_Total_Fitness ~ bud.duration + (1|pop), #changed this to be the log of total fitness to make it more normal 
                              data=WL2_total_fit_bud_dur)
summary(WL2_bud_dur_total_fit) #sig neg relat 
Anova(WL2_bud_dur_total_fit)

WL2_bud_dur_total_fit2 <- lmer(log_WL2_Total_Fitness ~ bud.duration + (1|pop) + (1|block), #changed this to be the log of total fitness to make it more normal 
                              data=WL2_total_fit_bud_dur)
summary(WL2_bud_dur_total_fit2) #relat no longer sig with block in the model
Anova(WL2_bud_dur_total_fit2)

ggplot(WL2_total_fit_bud_dur, aes(x=bud.duration, y=WL2_Total_Fitness, color=pop)) +
  geom_point() +
  facet_wrap(~block) #some blocks only have 1 or 2 individuals 
WL2_total_fit_bud_dur %>% group_by(block) %>% summarise(n=n()) %>% arrange(n) #take blocks D and L out since less than 3 individuals

WL2_total_fit_bud_dur_blocks <- WL2_total_fit_bud_dur %>% 
  filter(block!="D", block!="L")

WL2_bud_dur_total_fit3 <- lmer(log_WL2_Total_Fitness ~ bud.duration + (1|pop) + (1|block),
                                   data=WL2_total_fit_bud_dur_blocks)
summary(WL2_bud_dur_total_fit3) #relat still not sig 
Anova(WL2_bud_dur_total_fit3)
```

```{r}
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.date_dt))) %>% filter(!(is.na(WL2_Total_Fitness))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)

ggplot(WL2_total_fit_bud_dur, aes(x=bud.date_dt, y=WL2_Total_Fitness, color=pop)) +
  geom_point()

WL2_dt_bud_total_fit <- lmer(log_WL2_Total_Fitness ~ bud.date_dt + (1|pop),
                              data=WL2_total_fit_bud_dur)
summary(WL2_dt_bud_total_fit) #not sig 
Anova(WL2_dt_bud_total_fit)

WL2_dt_bud_total_fit2 <- lmer(log_WL2_Total_Fitness ~ bud.date_dt + (1|pop) + (1|block),
                              data=WL2_total_fit_bud_dur)
summary(WL2_dt_bud_total_fit2) #now a sig pos relat but coef is very small 
Anova(WL2_dt_bud_total_fit2)
```

## Fruits/FrFLN ~ Phenology 
Note that fruit number is very skewed so these models are not usable.

### Bud duration at UCD and number of fruits/FrFlN

```{r}
#1) include 0's but not NA's 
#2) exclude NA's but use FrFlN - compare the fruit model to FrFlN model

init.repro %>% filter(site == "UCD")  %>% filter(!(is.na(bud.duration))) %>% filter(!(is.na(Fruits))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
UCD_bud_fruit <- init.repro %>%
  filter(site == "UCD") %>%
  filter(!(is.na(Fruits))) %>%
  mutate(logFruits=log(Fruits+1)) %>% 
  #filter(Fruits > 0) %>% #do we wannt to do this?
  filter(!(is.na(bud.duration))) %>%
  filter(pop %in% c("BH", "TM2"))# %>% #only 2 pops with high enough sample size 

UCD_bud_fruit %>% #very skewed 
  ggplot(aes(Fruits)) +
  geom_histogram()
UCD_bud_fruit %>% #log transformation helps a little, but still not great 
  ggplot(aes(logFruits)) +
  geom_histogram()

ggplot(UCD_bud_fruit, aes(x=bud.duration, y=Fruits, color=pop))+
  geom_point() #visually, generally the longer the bud duration, the more fruit but this is driven by TM2

UCD_bud_dur_fruit <- lmer(Fruits ~ bud.duration + (1|pop),
                          data=UCD_bud_fruit) #only TM2 and BH in the model but multiple individuals from both 
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dur_fruit)
Anova(UCD_bud_dur_fruit) #Significant relationship between bud duration and fruit number

UCD_bud_dur_fruit2 <- lmer(Fruits ~ bud.duration + (1|pop) + (1|block),
                          data=UCD_bud_fruit) 
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dur_fruit2)
Anova(UCD_bud_dur_fruit2) #marginal pos relationship between bud duration and fruit number w/ block in model

UCD_bud_dur_fruit3 <- lmer(logFruits ~ bud.duration + (1|pop) + (1|block),
                          data=UCD_bud_fruit) 
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dur_fruit3) #relat no longer sig
Anova(UCD_bud_dur_fruit3) 

#Testing fruit and flower number
UCD_bud_dur_FrFlN <- lmer(FrFlw ~ bud.duration + (1|pop),
                          data=UCD_bud_fruit)
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dur_FrFlN) #Significant relationship between bud duration and fruit + flower number
Anova(UCD_bud_dur_FrFlN) 

UCD_bud_dur_FrFlN2 <- lmer(FrFlw ~ bud.duration + (1|pop) + (1|block),
                          data=UCD_bud_fruit)
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dur_FrFlN2)  #Significant pos relationship between bud duration and fruit + flower number w/ block in model
Anova(UCD_bud_dur_FrFlN2)
```

### Bud timing at UCD and number of fruits/FrFlN
```{r}
init.repro %>% filter(site == "UCD")  %>% filter(!(is.na(bud.date_dt))) %>% filter(!(is.na(Fruits))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
UCD_dt_bud_fruit <- init.repro %>%
  filter(site == "UCD") %>%
  filter(!(is.na(Fruits))) %>%
  mutate(logFruits=log(Fruits+1)) %>% 
  #filter(Fruits > 0) %>% #do we wannt to do this?
  filter(!(is.na(bud.date_dt))) %>%
  filter(pop %in% c("BH", "TM2"))# %>% #only 2 pops with high enough sample size 
  
ggplot(UCD_dt_bud_fruit, aes(x=bud.date_dt, y=Fruits, color=pop)) +
  geom_point()

UCD_bud_dt_fruit <- lmer(Fruits ~ bud.date_dt + (1|pop),
                          data=UCD_dt_bud_fruit) 
summary(UCD_bud_dt_fruit) #not sig
Anova(UCD_bud_dt_fruit) 

UCD_bud_dt_fruit2 <- lmer(Fruits ~ bud.date_dt + (1|pop) + (1|block),
                          data=UCD_dt_bud_fruit) 
#boundary (singular) fit: see help('isSingular') b/c pop explains 0 var 
summary(UCD_bud_dt_fruit2) #not sig

UCD_bud_dt_fruit3 <- lmer(logFruits ~ bud.date_dt + (1|pop) + (1|block),
                          data=UCD_dt_bud_fruit) 
summary(UCD_bud_dt_fruit3) #not sig

#Testing fruit and flower number
UCD_bud_dt_FrFlN <- lmer(FrFlw ~ bud.date_dt + (1|pop),
                          data=UCD_dt_bud_fruit) 
summary(UCD_bud_dt_FrFlN) #marginally neg relat (small coef)
Anova(UCD_bud_dt_FrFlN) 

UCD_bud_dt_FrFlN2 <- lmer(FrFlw ~ bud.date_dt + (1|pop) + (1|block),
                          data=UCD_dt_bud_fruit) 
summary(UCD_bud_dt_FrFlN2) #not sig
```

### Bud duration and fruit/FrFlN at WL2

```{r}
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.duration))) %>% filter(!(is.na(Fruits))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.duration))) %>% filter(!(is.na(FrFlw))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
WL2_bud_fit <- init.repro %>%
  filter(site == "WL2") #%>%
  #left_join(WL2_24_fruit %>% select(bed, row, col, fruits, FrFlN), by=c("bed", "row", "col")) %>% #already done in init.repo
  #left_join(WL2_23_fruit %>% select(bed, row, col, fruits, FrFlN), by=c("bed", "row", "col")) %>% #already done in init.repo
 # mutate(  #already done in init.repo
#    fruits = coalesce(fruits.x, fruits.y),  # Combine fruits from both years
#    FrFlN = coalesce(FrFlN.x, FrFlN.y)    # Combine FrFlN from both years
 # ) %>%
 # select(-fruits.x, -fruits.y, -FrFlN.x, -FrFlN.y) 

WL2_bud_fit %>% #very skewed 
  ggplot(aes(Fruits)) +
  geom_histogram()

WL2_bud_dur_fit <- WL2_bud_fit %>%
  filter(!(is.na(bud.duration))) %>%
  filter(!(is.na(Fruits))) %>% 
  mutate(logFruits=log(Fruits+1)) %>% 
  filter(!(pop %in% c("SQ1", "WR"))) #too few individuals 

WL2_bud_dur_fit %>% #log transformation helped 
  ggplot(aes(logFruits)) +
  geom_histogram()

ggplot(WL2_bud_dur_fit, aes(x=bud.duration, y=Fruits, color=pop))+
  geom_point()

WL2_bud_dur_fruit <- lmer(logFruits ~ bud.duration + (1|pop),
                          data=WL2_bud_dur_fit)
summary(WL2_bud_dur_fruit) #sig negative relationship between bud duration and fruit number
Anova(WL2_bud_dur_fruit)

WL2_bud_dur_fruit2 <- lmer(logFruits ~ bud.duration + (1|pop) + (1|block),
                          data=WL2_bud_dur_fit)
summary(WL2_bud_dur_fruit2) #relat no longer sig 

#testing with FrFlN
WL2_bud_dur_FrFl <- WL2_bud_fit %>%
  filter(!(is.na(bud.duration))) %>%
  filter(!(is.na(FrFlw))) %>% 
  mutate(logFrFlw=log(FrFlw+1)) %>% 
  filter(!(pop %in% c("SQ1", "WR"))) #too few individuals 

WL2_bud_dur_FrFl %>% #log transformation helped 
  ggplot(aes(logFrFlw)) +
  geom_histogram()

ggplot(WL2_bud_dur_FrFl, aes(x=bud.duration, y=FrFlw, color=pop))+
  geom_point()

WL2_bud_dur_FrFlN <- lmer(logFrFlw ~ bud.duration + (1|pop),
                          data=WL2_bud_dur_FrFl)
summary(WL2_bud_dur_FrFlN) #sig negative relationship between bud duration and fruit + flower number
Anova(WL2_bud_dur_FrFlN)

WL2_bud_dur_FrFlN2 <- lmer(logFrFlw ~ bud.duration + (1|pop) + (1|block),
                          data=WL2_bud_dur_FrFl)
summary(WL2_bud_dur_FrFlN2) #relat now marginal 
```

### Bud timing and fruit/FrFlN at WL2
```{r}
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.date_dt))) %>% filter(!(is.na(Fruits))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)
init.repro %>% filter(site == "WL2")  %>% filter(!(is.na(bud.date_dt))) %>% filter(!(is.na(FrFlw))) %>% group_by(pop) %>% summarise(n=n()) %>% arrange(n)

WL2_dt_bud_fruit <- WL2_bud_fit %>%
  filter(!(is.na(bud.date_dt))) %>%
  filter(!(is.na(Fruits))) %>% 
  mutate(logFruits=log(Fruits+1)) %>% 
  filter(!(pop %in% c("SQ1", "WR"))) #too few individuals
  
ggplot(WL2_dt_bud_fruit, aes(x=bud.date_dt, y=Fruits, color=pop)) +
  geom_point()

WL2_bud_dt_fruit <- lmer(logFruits ~ bud.date_dt + (1|pop),
                          data=WL2_dt_bud_fruit) 
summary(WL2_bud_dt_fruit) #no sig relat
Anova(WL2_bud_dt_fruit) 

WL2_bud_dt_fruit2 <- lmer(logFruits ~ bud.date_dt + (1|pop) + (1|block),
                          data=WL2_dt_bud_fruit) 
summary(WL2_bud_dt_fruit2) #relat now sig (positive)

#testing with FrFlN
WL2_dt_bud_FrFl <- WL2_bud_fit %>%
  filter(!(is.na(bud.date_dt))) %>%
  filter(!(is.na(FrFlw))) %>% 
  mutate(logFrFlw=log(FrFlw+1)) %>% 
  filter(!(pop %in% c("SQ1", "WR"))) #too few individuals 

ggplot(WL2_dt_bud_FrFl, aes(x=bud.date_dt, y=FrFlw, color=pop)) +
  geom_point()

WL2_bud_dt_FrFlN <- lmer(logFrFlw ~ bud.date_dt + (1|pop),
                          data=WL2_dt_bud_FrFl) 
summary(WL2_bud_dt_FrFlN) #not sig 
Anova(WL2_bud_dt_FrFlN) 

WL2_bud_dt_FrFlN2 <- lmer(logFrFlw ~ bud.date_dt + (1|pop) + (1|block),
                          data=WL2_dt_bud_FrFl) 
summary(WL2_bud_dt_FrFlN2) #relat now sig (pos)
```

## Rx norms for total repro duration and bud duration - only BH and TM2

```{r, eval=FALSE}
#repro_summary %>%
 # filter(N_repro != 1) %>%
  #ggplot(aes(x=site, y=mean_total_dur, group=pop, color=elev_m)) +
  #geom_point(size=1.5) +
  #geom_line(size=1) +
  #geom_errorbar(aes(ymin=mean_total_dur-sem_total_dur, ymax=mean_total_dur+sem_total_dur), width=0.1) 

#repro_summary %>%
 # filter(N_bud != 1) %>%
  #ggplot(aes(x=site, y=mean_bud_dur, group=pop, color=elev_m)) +
  #geom_point(size=1.5) +
  #geom_line(size=1) +
  #geom_errorbar(aes(ymin=mean_bud_dur-sem_bud_dur, ymax=mean_bud_dur+sem_bud_dur), width=0.1) 
```

```{r, eval=FALSE}
#dt_flw_summary <- init.repro %>%
 # group_by(pop, site, elev_m) %>%
 # summarize(N_flw = sum(!is.na(flower.date_dt)),
  #          mean_dt_flw = mean(flower.date_dt, na.rm=(TRUE)),
   #         sem_dt_flw = sem(flower.date_dt, na.rm=(TRUE))
   #         )

#dt_flw_summary %>%
 ## filter(N_flw != 1) %>%
 # ggplot(aes(x=site, y=mean_dt_flw, group=pop, color=elev_m)) +
 # geom_point(size=1.5) +
 # geom_line(size=1) +
 # geom_errorbar(aes(ymin=mean_dt_flw-sem_dt_flw, ymax=mean_dt_flw+sem_dt_flw), width=0.1) +
 # scale_colour_gradient(low = "#F5A540", high = "#0043F0")

```

```{r, eval=FALSE}
#dt_fr_summary <- init.repro %>%
#  group_by(pop, site, elev_m) %>%
 # summarize(N_fr = sum(!is.na(fruit.date_dt)),
    #        mean_dt_fr = mean(fruit.date_dt, na.rm=(TRUE)),
    #        sem_dt_fr = sem(fruit.date_dt, na.rm=(TRUE))
    #        )

#dt_fr_summary %>%
#  filter(N_fr != 1) %>%
 # ggplot(aes(x=site, y=mean_dt_fr, group=pop, color=elev_m)) +
 # geom_point(size=1.5) +
 # geom_line(size=1) +
 # geom_errorbar(aes(ymin=mean_dt_fr-sem_dt_fr, ymax=mean_dt_fr+sem_dt_fr), width=0.1) +
 # scale_colour_gradient(low = "#F5A540", high = "#0043F0")
```


## Does flowering duration differ by pop at WL2?
Not a high enough sample size/variation to do this analysis 
```{r, eval=FALSE}
WL2_24_flw_dur <- init.repro %>%
  filter(site == "WL2") %>%
  filter(year == 24) %>%
  filter(!(is.na(flower.duration))) %>%
  filter(pop %in% c("BH", "CC", "IH", "SC", "TM2", "WL2", "YO7")) %>%
  left_join(both_clim_dist_WL2_24 %>% select(pop, GrwSsn_GD, Wtr_Year_GD), by="pop")

ggplot(WL2_24_flw_dur, aes(x=flower.duration))+
  geom_boxplot()+
  facet_wrap(~pop)

WL2_flw_dur_elev <- lmer(flower.duration ~ elev_m + (1|pop),
                    data = WL2_24_flw_dur) #singularity warning
summary(WL2_flw_dur_elev)
Anova(WL2_flw_dur_elev) #marginally significant

WL2_flw_dur_lat <- lmer(flower.duration ~ Lat + (1|pop),
                        data=WL2_24_flw_dur)
summary(WL2_flw_dur_lat)
Anova(WL2_flw_dur_lat) #not significant


#Testing climate distance - not significant for either
WL2_flw_dur_grw_ssn <- lmer(flower.duration ~ GrwSsn_GD + (1|pop),
                            data=WL2_24_flw_dur)
summary(WL2_flw_dur_grw_ssn)
Anova(WL2_flw_dur_grw_ssn)

WL2_flw_dur_wtr_year <- lmer(flower.duration ~ Wtr_Year_GD + (1|pop),
                            data=WL2_24_flw_dur)
summary(WL2_flw_dur_wtr_year)
Anova(WL2_flw_dur_wtr_year)
```

## Does fruiting duration differ by pop at WL2?
Not a high enough sample size/variation to do this analysis 
```{r, eval=FALSE}
WL2_24_fr_dur <- init.repro %>%
  filter(site == "WL2") %>%
  filter(year == 24) %>%
  filter(!(is.na(fruit.duration))) %>%
  filter(pop %in% c("BH", "CC", "IH", "SC", "TM2", "WL2", "YO7")) %>%
  left_join(both_clim_dist_WL2_24 %>% select(pop, GrwSsn_GD, Wtr_Year_GD), by="pop")

ggplot(WL2_24_fr_dur, aes(x=fruit.duration))+
  geom_boxplot()+
  facet_wrap(~pop)

WL2_fr_dur_elev <- lmer(fruit.duration ~ elev_m + (1|pop),
                    data = WL2_24_fr_dur)
summary(WL2_fr_dur_elev)
Anova(WL2_fr_dur_elev) 

WL2_fr_dur_lat <- lmer(fruit.duration ~ Lat + (1|pop),
                        data=WL2_24_fr_dur)
summary(WL2_fr_dur_lat)
Anova(WL2_fr_dur_lat) #neither elevation nor lat is significant


#Testing climate distance - not significant for either
WL2_fr_dur_grw_ssn <- lmer(fruit.duration ~ GrwSsn_GD + (1|pop),
                            data=WL2_24_fr_dur)
summary(WL2_fr_dur_grw_ssn)
Anova(WL2_fr_dur_grw_ssn)

WL2_fr_dur_wtr_year <- lmer(fruit.duration ~ Wtr_Year_GD + (1|pop),
                            data=WL2_24_fr_dur)
summary(WL2_fr_dur_wtr_year)
Anova(WL2_fr_dur_wtr_year)
```


